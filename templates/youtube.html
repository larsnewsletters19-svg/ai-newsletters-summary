{% extends "base.html" %}

{% block content %}
<div class="bg-white rounded-lg shadow p-6 mb-6">
    <h2 class="text-xl font-bold mb-4">‚ûï L√§gg till YouTube-video</h2>
    <form id="addForm" class="space-y-4">
        <div>
            <label class="block text-sm font-medium mb-1">Titel *</label>
            <input type="text" name="title" required 
                   class="w-full border rounded px-3 py-2">
        </div>
        <div>
            <label class="block text-sm font-medium mb-1">URL *</label>
            <input type="url" name="url" required 
                   class="w-full border rounded px-3 py-2">
        </div>
        <div class="grid grid-cols-2 gap-4">
            <div>
                <label class="block text-sm font-medium mb-1">Kategori</label>
                <input type="text" name="category" 
                       class="w-full border rounded px-3 py-2">
            </div>
            <div>
                <label class="block text-sm font-medium mb-1">Typ</label>
                <input type="text" name="type" 
                       class="w-full border rounded px-3 py-2">
            </div>
        </div>
        <div>
            <label class="block text-sm font-medium mb-1">Publiceringsdatum</label>
            <input type="text" id="published_date" name="published_date" 
                   placeholder="√Ö√Ö√Ö√ÖMMDD"
                   maxlength="10"
                   class="w-full border rounded px-3 py-2">
            <p class="text-xs text-gray-500 mt-1">Skriv 8 siffror (t.ex. 20251220)</p>
        </div>
        <div>
            <label class="block text-sm font-medium mb-1">Beskrivning</label>
            <textarea name="description" rows="3" 
                      class="w-full border rounded px-3 py-2"></textarea>
        </div>
        <button type="submit" 
                class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded">
            L√§gg till
        </button>
    </form>
</div>

<div class="bg-white rounded-lg shadow p-6">
    <h2 class="text-xl font-bold mb-4">üé• YouTube-videos ({{ videos|length }})</h2>
    <div class="space-y-3">
        {% for video in videos %}
        <div class="border rounded p-4 {% if not video.is_active %}bg-gray-50 opacity-50{% endif %}">
            <div class="flex justify-between items-start">
                <div class="flex-1">
                    <h3 class="font-semibold">{{ video.title }}</h3>
                    <p class="text-sm text-gray-600 mt-1">
                        <a href="{{ video.url }}" target="_blank" class="text-blue-600 hover:underline">
                            {{ video.url }}
                        </a>
                    </p>
                    {% if video.published_date %}
                    <p class="text-sm text-gray-500 mt-1">
                        üìÖ {{ video.published_date[:10] if video.published_date|length > 10 else video.published_date }}
                    </p>
                    {% endif %}
                    {% if video.category or video.type %}
                    <p class="text-sm text-gray-500 mt-1">
                        {% if video.category %}<span class="bg-blue-100 px-2 py-1 rounded">{{ video.category }}</span>{% endif %}
                        {% if video.type %}<span class="bg-purple-100 px-2 py-1 rounded ml-1">{{ video.type }}</span>{% endif %}
                    </p>
                    {% endif %}
                    {% if video.description %}
                    <p class="text-sm text-gray-700 mt-2">{{ video.description }}</p>
                    {% endif %}
                </div>
                <div class="flex space-x-2 ml-4">
                    <button onclick="toggleVideo({{ video.id }})" 
                            class="{% if video.is_active %}bg-yellow-100 hover:bg-yellow-200 text-yellow-700{% else %}bg-green-100 hover:bg-green-200 text-green-700{% endif %} px-3 py-1 rounded text-sm">
                        {% if video.is_active %}Inaktivera{% else %}Aktivera{% endif %}
                    </button>
                    <button onclick="deleteVideo({{ video.id }})" 
                            class="bg-red-100 hover:bg-red-200 text-red-700 px-3 py-1 rounded text-sm">
                        Ta bort
                    </button>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Auto-formatera datum medan anv√§ndaren skriver
document.getElementById('published_date').addEventListener('input', function(e) {
    let value = e.target.value.replace(/\D/g, ''); // Ta bort icke-siffror
    if (value.length >= 4) {
        value = value.slice(0, 4) + '-' + value.slice(4);
    }
    if (value.length >= 7) {
        value = value.slice(0, 7) + '-' + value.slice(7);
    }
    e.target.value = value.slice(0, 10);
});

document.getElementById('addForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const formData = new FormData(e.target);
    const data = Object.fromEntries(formData);
    
    try {
        const response = await fetch('/api/youtube', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        });
        
        if (response.ok) {
            alert('‚úÖ Video tillagd!');
            location.reload();
        } else {
            const error = await response.json();
            alert('‚ùå Fel: ' + error.error);
        }
    } catch (error) {
        alert('‚ùå Fel: ' + error);
    }
});

async function toggleVideo(id) {
    try {
        const response = await fetch(`/api/youtube/${id}/toggle`, { method: 'POST' });
        if (response.ok) {
            location.reload();
        }
    } catch (error) {
        alert('‚ùå Fel: ' + error);
    }
}

async function deleteVideo(id) {
    if (!confirm('√Ñr du s√§ker p√• att du vill ta bort denna video?')) return;
    
    try {
        const response = await fetch(`/api/youtube/${id}`, { method: 'DELETE' });
        if (response.ok) {
            alert('‚úÖ Video borttagen!');
            location.reload();
        }
    } catch (error) {
        alert('‚ùå Fel: ' + error);
    }
}
</script>
{% endblock %}
